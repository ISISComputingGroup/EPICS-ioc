#
# ADD:
# 
# setResistanceMode PV: how to factor in @101 channels etc
#
###############


record(stringin, "$(P)IDN")
{
    field(DESC, "SCPI identification string")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getIDN $(PORT)")
    field(PINI, "YES")
}

record(bo, "$(P)BUFFER:CLEAR:SP")
{
	field(DESC, "Trigger a buffer clear")
	field(DTYP, "stream")
	field(ZNAM, "")
	field(ONAM, "")
	field(OUT, "@devKeithley_2700.proto clearBuffer $(PORT)")    


}
alias("$(P)BUFFER:CLEAR:SP","$(P)BUFFER:CLEAR")

# source of the buffer feed: sense, calculate, or none
record(mbbi, "$(P)BUFFER:SOURCE") 
{
    field(DESC, "Get current buffer source")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getBufferFeedSource $(PORT)")
    field(ZRST, "SENS")
    field(ONST, "CALC")
    field(TWST, "NONE")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")
}

record(mbbo, "$(P)BUFFER:SOURCE:SP") 
{
    field(DESC, "Set buffer feed source")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setBufferFeedSource $(PORT)")
    field(ZRST, "SENS")
    field(ONST, "CALC")
    field(TWST, "NONE")
}

record(bi, "$(P)BUFFER:CLEAR:AUTO") 
{
    field(DESC, "Return buffer clear mode status")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getBufferAutoClearStatus $(PORT)")
    field(ZNAM, "ON")
    field(ONAM, "OFF")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")
}

record(bo, "$(P)BUFFER:CLEAR:AUTO:SP") 
{
    field(DESC, "Set Buffer State")
    field(SCAN, "Passive")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setBufferAutoClearStatus $(PORT)")
    field(ZNAM, "ON")
    field(ONAM, "OFF")
}

record(ai, "$(P)BUFFER:NEXT") 
{
    field(DESC, "Next Buffer reading location")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getNextBufferReadingLoc $(PORT)")
}

# Records also receives value for MEM:USED and sets its value 
record(ai, "$(P)BUFFER:MEM:AVAIL")
{
    field(DESC, "Available buffer bytes")
    field(DTYP, "stream")
	field (SCAN, "1 second")	
    field(INP,  "@devKeithley_2700.proto getBufferMemory($(P)BUFFER:MEM:USED) $(PORT)")
	field(EGU, "b")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")
}

record(ai, "$(P)BUFFER:MEM:USED")
{
    field(DESC, "Bytes used by buffer for stored readings")
    field(DTYP, "stream")
	field(EGU, "b")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")
}

## return string of readings from Start to +Count
record(stringin, "$(P)BUFFER:READINGS")
{
    field(DESC, "Buffer Readings")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getBuffReadRange($(P)START,$(P)COUNT) $(PORT)")
    field(SCAN, "1 second")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")
}

record(ai, "$(P)START") 
{
    field(DESC, "Starting mem location of buffer readings")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    info(INTEREST, "LOW")
}
alias("$(P)START","$(P)START:SP")

record(ai, "$(P)COUNT") 
{
    field(DESC, "Buffer memory locations to read")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    info(INTEREST, "LOW")
}
alias("$(P)COUNT","$(P)COUNT:SP")

# number of valuesin the buffer: can be set when buffer:clear:auto is off
record(ai, "$(P)BUFFER:SIZE") 
{
	field(DESC, "Get Size of Buffer")
	field(SCAN, "1 second")
	field(DTYP, "stream")
	field(INP,  "@devKeithley_2700.proto getBufferSize $(PORT)")
	field(HIHI, "55001")
	field(LOLO, "1")
	field(HHSV,"MAJOR")
	field(LLSV,"MAJOR")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")
}

record(ao, "$(P)BUFFER:SIZE:SP") 
{
    field(DESC, "Set Size of Buffer")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setBufferSize $(PORT)")
    field(HIHI, "55001")
    field(LOLO, "1")
    field(HHSV,"MAJOR")
    field(LLSV,"MAJOR")
}

record(bi, "$(P)TIMESTAMP") 
{
    field(DESC, "Query Time Stamp Format")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getTimeStamp $(PORT)")
    field(ZNAM, "ABS")
    field(ONAM, "DELT")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")

}

record(bo, "$(P)STAMP:SP") 
{
    field(DESC, "Set Time Stamp Format")
    field(SCAN, "Passive")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setTimeStamp $(PORT)")
    field(ZNAM, "ABS")
    field(ONAM, "DELT")

}


 record(bi, "$(P)DELAYMODE") 
{
    field(DESC, "Enable/Disable auto delay")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getDelayState $(PORT)")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")

}

record(bo, "$(P)DELAYMODE:SP") 
{
    field(DESC, "Enable/Disable auto delay")
    field(SCAN, "Passive")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setDelayState $(PORT)")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")

}


record(bi, "$(P)INITMODE") 
{
    field(DESC, "continuous initiation state - default on")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getInitState $(PORT)")
    field(ZNAM, "ON")
    field(ONAM, "OFF")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")

}

record(bo, "$(P)INITMODE:SP") 
{
    field(DESC, "Enable/Disable continuous initiation")
    field(SCAN, "Passive")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setInitState $(PORT)")
    field(ZNAM, "ON")
    field(ONAM, "OFF")
	info(ARCHIVE, "VAL")
    info(INTEREST, "HIGH")

}


record(ai, "$(P)SAMPLECOUNT") 
{
    field(DESC, "Query sample count")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getSampleCount $(PORT)")
    field(HIHI, "55001")
    field(LOLO, "1")
    field(HHSV,"MAJOR")
    field(LLSV,"MAJOR")
    info(INTEREST, "HIGH")
	info(ARCHIVE, "VAL")
}

record(ao, "$(P)SAMPLECOUNT:SP") 
{
    field(DESC, "Set sample count")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setSampleCount $(PORT)")
    field(HIHI, "55001")
    field(LOLO, "1")
    field(HHSV,"MAJOR")
    field(LLSV,"MAJOR")
}


record(mbbi, "$(P)CONTROLSOURCE:SP") 
{
    field(DESC, "Set Control source")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(INP,  "@devKeithley_2700.proto getControlSource $(PORT)")
    field(ZRST, "IMM")
    field(ONST, "TIM")
    field(TWST, "MAN")
    field(THST, "BUS")
    field(FRST, "EXT")
    info(INTEREST, "HIGH")
	info(ARCHIVE, "VAL")
    }

record(mbbo, "$(P)CONTROLSOURCE:SP") 
{
    field(DESC, "Get control source")
    field(DTYP, "stream")
    field(OUT,  "@devKeithley_2700.proto setControlSource $(PORT)")
    field(ZRST, "IMM")
    field(ONST, "TIM")
    field(TWST, "MAN")
    field(THST, "BUS")
    field(FRST, "EXT")
	info(INTEREST, "HIGH")
	info(ARCHIVE, "VAL")
}

alias("$(P)CONTROLSOURCE:SP","$(P)CONTROLSOURCE")





# >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
