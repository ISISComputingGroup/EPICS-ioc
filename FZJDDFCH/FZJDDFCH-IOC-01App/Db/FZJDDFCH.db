#
# DB File for the FZJ Digital Drive Fermi Chopper Controller
#
record(bo, "$(P)SIM")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
    field(ZNAM, "NO")
    field(ONAM, "YES")
    field(VAL, "$(RECSIM=0)")
}
#
record(bo, "$(P)DISABLE")
{
  field(DESC, "Disable comms")
  field(PINI, "YES")
  field(VAL, "$(DISABLE=0)")
  field(OMSL, "supervisory")
  field(ZNAM, "COMMS ENABLED")
  field(ONAM, "COMMS DISABLED")
}
#
record(stringin, "$(P)ADDRESS")
{   
  field(DESC, "Chopper name/address")
  field(PINI, "YES")
  field(VAL, "$(ADDR)")
}
#
# reference speed [Hz]
# RESP!
# 20.00 to 26.00 and 32.00 to 100.00
# only assumed from masterchopper (chopper 3)
# two decimal places
# 
## **** RATI command looks to be unused in the protocol for the controller ****
# 
# ratio
# RATI!
# 1 or 2
# ratio to reference speed, 1 = 1:1, 2 = 1:2,
# only assumed from chopper 3
# no decimal places
# 
# factor
# FACT!
# 1:12
# multiplication factor of reference speed
# speed setpoint
# no decimal places
#
record(mbbo, "$(P)FREQ:SP")
{
    field(DESC, "Frequency Setpoint")
    field(DTYP, "stream")
    field(OUT, "@devFZJ_DDFermiChopper.proto setFACT($(P)) $(PORT)")
    field(ZRVL, "1")
    field(ONVL, "2")
    field(TWVL, "3")
    field(THVL, "4")
    field(FRVL, "5")
    field(FVVL, "6")
    field(SXVL, "7")
    field(SVVL, "8")
    field(EIVL, "9")
    field(NIVL, "10")
    field(TEVL, "11")
    field(ELVL, "12")
    field(ZRST, "50")
    field(ONST, "100")
    field(TWST, "150")
    field(THST, "200")
    field(FRST, "250")
    field(FVST, "300")
    field(SXST, "350")
    field(SVST, "400")
    field(EIST, "450")
    field(NIST, "500")
    field(TEST, "550")
    field(ELST, "600")
    info(INTEREST, "HIGH")
    info(archive, "VAL")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:FREQ:SP")
    field(SDIS, "$(P)DISABLE")
}
#
# PV to contain returned error message, if any
#
record(stringin, "$(P)FREQ:SP:ERROR")
{
    field(DESC, "Error that occured on setting frequency")
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# setpoint phase [degrees]
# PHAS!
# 0.01 to 359.99
# two decimal places
#
record(ao, "$(P)PHAS:SP")
{
    field(DESC, "Phase Setpoint")
    field(DTYP, "stream")
    field(OUT, "@devFZJ_DDFermiChopper.proto setPHAS($(P)) $(PORT)")
    field(EGU, "deg")
    field(PREC, "2")
    info(INTEREST, "HIGH")
    info(archive, "VAL")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:PHAS:SP")
    field(SDIS, "$(P)DISABLE")
}
#
# PV to contain returned error message, if any
#
record(stringin, "$(P)PHAS:SP:ERROR")
{
    field(DESC, "Error that occured on setting phase")
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# switch on magnetic bearing
# MAGB!
# ON
# it is not possible to switch off the magnetic bearing by command
#
record(bo, "$(P)MB:SP")
{
    field(DESC, "Magnetic Bearing Setpoint")
    field(DTYP, "stream")
    field(OUT, "@devFZJ_DDFermiChopper.proto setMAGB($(P)) $(PORT)")
    field(ZNAM, "ON")
    field(ONAM, "OFF")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:MB:SP")
    field(SDIS, "$(P)DISABLE")
}
#
# PV to contain returned error message, if any
#
record(stringin, "$(P)MB:SP:ERROR")
{
    field(DESC, "Error that occured on setting MB")
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# drive start/stop
# DRIV!
# START or STOP
#
record(bo, "$(P)DRIVE:MODE:SP")
{
    field(DESC, "Drive mode setpoint")
    field(DTYP, "stream")
    field(OUT, "@devFZJ_DDFermiChopper.proto setDRIV($(P)) $(PORT)")
    field(ZNAM, "START")
    field(ONAM, "STOP")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:DRIVE:MODE:SP")
    field(SDIS, "$(P)DISABLE")
}
alias("$(P)DRIVE:MODE:SP", "$(P)DRV:MODE:SP")
#
# PV to contain returned error message, if any
#
record(stringin, "$(P)DRIVE:MODE:SP:ERROR")
{
    field(DESC, "Error that occured on setting drive mode")
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DRIVE:MODE:SP:ERROR", "$(P)DRV:MODE:SP:ERROR")
#
# acknowledge messages
# ACKN!
# ON
#
#
# first record causes concatenated status string to be read
# then protocol file splits response into separate values
# and writes them to specified PVs
#
# See the following VI for details on how the reply to the ASTA? command is formed:
# MAPS_251115_C6713_LV2010\RAL Neu\MAPS_251115_C6713_LV2014\LabVIEW\TCP.llb\TCP_Kommando_ASTA?.vi
#
# reference speed [Hz]
# RSPE?
# 20.00 to 26.00 and 32.00 to 100.00
# relating to master-chopper (chopper 3)
# two decimal places
#
record(ai, "$(P)FREQ:REF")
{
    field(DESC, "Reference Frequency")
    field(SCAN, "1 second")
    field(DTYP, "stream")
    field(EGU, "Hz")
    field(PREC, "2")
    field(INP, "@devFZJ_DDFermiChopper.proto getASTA($(P)) $(PORT)")
    info(INTEREST, "HIGH")
    info(archive, "VAL")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:FREQ:REF")
    field(SDIS, "$(P)DISABLE")
}
#
# setpoint speed [Hz]
# SSPE?
# 20.00 to 26.00 and 32.00 to 100.00
# two decimal places
#
record(ai, "$(P)FREQ:SP:RBV")
{
    field(DESC, "Frequency Setpoint Readback")
    field(EGU, "Hz")
    field(PREC, "2")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# **** RATI command looks to be unused in the protocol for the controller ****
# 
## ratio
## RATI?
## 1 or 2
## ratio to reference speed,
## 1 = 1:1, 2 = 1:2,
## no decimal places
#
#record(bi, "$(P)RATIO")
#{
#    field(DESC, "Ratio to reference frequency")
#    # field(EGU, "")
#    field(ZNAM, "1:1")
#    field(0NAM, "1:2")
#    info(INTEREST, "HIGH")
#    info(archive, "VAL")
#}
#
# current speed [Hz]
# SPEE?
# 0.00 to 100.00
# two decimal places
#
record(ai, "$(P)FREQ")
{
    field(DESC, "Current Frequency")
    field(EGU, "Hz")
    field(PREC, "2")    
    info(alarm, "FZJDDFCH_01") 
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# setpoint phase [º]
# SPHA?
# 0.01 to 359.99
# two decimal places
#
record(ai, "$(P)PHAS:SP:RBV")
{
    field(DESC, "Phase Setpoint Readback")
    field(EGU, "deg")
    field(PREC, "2")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# current phase [º]
# PHAS?
# 0.00 to 360.00 or –1.00
# if the current rotary frequency did not reach the setpoint frequency, the value is –1.00
# two decimal places
#
record(ai, "$(P)PHAS")
{
    field(DESC, "Current Phase")
    field(EGU, "deg")
    field(PREC, "2")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# status of phase
# PHOK?
# OK or NOK
# phase deviation = 0.1º means that the phase is OK
#
record(bi, "$(P)PHAS:STATUS")
{
    field(DESC, "Phase Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# magnetic bearing
# MBON?
# ON or OFF
#
record(bi, "$(P)MB")
{
    field(DESC, "Magnetic Bearing")
    field(ZNAM, "ON")
    field(ONAM, "OFF")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# status of magnetic bearing
# MBOK?
# OK or NOK
#
record(bi, "$(P)MB:STATUS")
{
    field(DESC, "Magnetic Bearing Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
#
# magnetic bearing integrator [%]
# MBIN?
# -100.0 to 100.0
# integrator of regulator for magnetic bearing
# one decimal place
#
record(ai, "$(P)MB:INT")
{
    field(DESC, "Mag Bearing Regulator Integrator")
    field(EGU, "%")
    field(PREC, "1")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# drive
# DRON?
# ON or OFF
#
record(bi, "$(P)DRIVE")
{
    field(DESC, "Drive")
    field(ZNAM, "ON")
    field(ONAM, "OFF")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
alias("$(P)DRIVE", "$(P)DRV")
#
# status of drive
# SDRI?
# START or STOP
#
record(bi, "$(P)DRIVE:MODE")
{
    field(DESC, "Drive Mode")
    field(ZNAM, "START")
    field(ONAM, "STOP")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
alias("$(P)DRIVE:MODE", "$(P)DRV:MODE")
#
# drive current L1 [A]
# DRL1?
# 0.00 to 15.00
# two decimal places
#
record(ai, "$(P)DRIVE:PHASE1:CURR")
{
    field(DESC, "Drive Current Phase 1")
    field(EGU, "A")
    field(PREC, "2")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DRIVE:PHASE1:CURR", "$(P)DRV:PHASE1:CURR")
#
# drive current L2 [A]
# DRL2?
# 0.00 to 15.00
# two decimal places
#
record(ai, "$(P)DRIVE:PHASE2:CURR")
{
    field(DESC, "Drive Current Phase 2")
    field(EGU, "A")
    field(PREC, "2")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DRIVE:PHASE2:CURR", "$(P)DRV:PHASE2:CURR")
#
# drive current L3 [A]
# DRL3?
# 0.00 to 15.00
# two decimal places
#
record(ai, "$(P)DRIVE:PHASE3:CURR")
{
    field(DESC, "Drive Current Phase 3")
    field(EGU, "A")
    field(PREC, "2")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DRIVE:PHASE3:CURR", "$(P)DRV:PHASE3:CURR")
#
# rotating direction
# RODI?
# CLOCK or ANTICLOCK
# in view of the drive
#
record(bi, "$(P)DRIVE:DIR")
{
    field(DESC, "Rotation Direction")
    field(ZNAM, "CW")
    field(ONAM, "CCW")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DRIVE:DIR", "$(P)DRV:DIR")
#
# Parking Position
# PPOS?
# OK or NOK
# OK if chopper is in open position
#
record(bi, "$(P)PARKED:OPEN:STATUS")
{
    field(DESC, "Parked Open Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "HIGH")
    info(archive, "VAL")
}
alias("$(P)PARKED:OPEN:STATUS", "$(P)PARKED:OPEN:STAT")
#
# drive temperature [ºC]
# DRIT?
# 0.00 to 150.00
# error if higher than 70.00ºC,
# two decimal places
#
record(ai, "$(P)DRIVE:TEMP")
{
    field(DESC, "Drive Temperature")
    field(EGU, "C")
    field(PREC, "2")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DRIVE:TEMP", "$(P)DRV:TEMP")
#
# input clock [Hz]
# INCL?
# 0.00 to 100.00
# two decimal places
#
record(ai, "$(P)INPUTCLOCK")
{
    field(DESC, "Input Clock Frequency")
    field(EGU, "Hz")
    field(PREC, "2")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# outage of the phase [s]
# OUPH?
# 0.00 to 7257600.00
# if one counter value = 7257600s (= 12 weeks), then self-acting reset of all counters triggered
# two decimal places
#
record(ai, "$(P)PHAS:OUTAGE")
{
    field(DESC, "Time out of Phase")
    field(EGU, "s")
    field(PREC, "2")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# master-chopper
# MACH?
# C01, C02, C2B or C03
# can be called from all choppers
#
record(mbbi, "$(P)MASTER")
{
    field(DESC, "Master Chopper")
    field(ZRVL, 0)
	field(ONVL, 1)
	field(TWVL, 2)
	field(THVL, 3)
	field(ZRST, "C01")
	field(ONST, "C02")
	field(TWST, "C2B")
	field(THST, "C03")     
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# log data
# LOON?
# ON or OFF
#
record(bi, "$(P)LOGGING")
{
    field(DESC, "Logging")
    field(ZNAM, "ON")
    field(ONAM, "OFF")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
#
# linear motion slide release
# LMSR?
# OK or NOK
# related to chopper 2
#
record(bi, "$(P)LMSR:STATUS")
{
    field(DESC, "Linear Motion Slide Release Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)LMSR:STATUS", "$(P)LMSR:STAT")
#
# DSP function control
# DSPM?
# OK or NOK
#
record(bi, "$(P)DSP:STATUS")
{
    field(DESC, "DSP Function Control Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias("$(P)DSP:STATUS", "$(P)DSP:STAT")
#
# interlock - external release
# EROK?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:ER:STATUS")
{
    field(DESC, "Interlock - External Release Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:ER:STATUS", "$(P)IL:ER:STAT")
#
# interlock - vacuum
# VAOK?
# OK oder NOK
#
record(bi, "$(P)INTERLOCK:VAC:STATUS")
{
    field(DESC, "Interlock - Vacuum Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:VAC:STATUS", "$(P)IL:VAC:STAT")
#
# interlock - rotary frequency monitoring
# SMOK?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:FREQMON:STATUS")
{
    field(DESC, "Interlock - Rotary Freq Mon Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:FREQMON:STATUS", "$(P)IL:FREQMON:STAT")
#
# interlock - magnetic bearing amplifier temperature
# MBAT?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:MB:AMP:TEMP:STATUS")
{
    field(DESC, "Interlock - Mag Brng Amp Temp Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:MB:AMP:TEMP:STATUS", "$(P)IL:MB:TEMP:STAT")
#
# interlock - magnetic bearing amplifier current
# MBAC?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:MB:AMP:CURR:STATUS")
{
    field(DESC, "Interlock - Mag Brng Amp Curr Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:MB:AMP:CURR:STATUS", "$(P)IL:MB:CURR:STAT")
#
# interlock - drive amplifier temperature
# DRAT?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:DRIVE:AMP:TEMP:STATUS")
{
    field(DESC, "Interlock - Drive Amp Temp Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:DRIVE:AMP:TEMP:STATUS", "$(P)IL:DRV:TEMP:STAT")
#
# interlock - drive amplifier current
# DRAC?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:DRIVE:AMP:CURR:STATUS")
{
    field(DESC, "Interlock - Drive Amp Curr Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:DRIVE:AMP:CURR:STATUS", "$(P)IL:DRV:CURR:STAT")
#
# interlock - UPS
# PSOK?
# OK or NOK
#
record(bi, "$(P)INTERLOCK:UPS:STATUS")
{
    field(DESC, "Interlock - UPS Status")
    field(ZNAM, "OK")
    field(ONAM, "NOK")    
    info(INTEREST, "MEDIUM")
    info(archive, "VAL")
}
alias ("$(P)INTERLOCK:UPS:STATUS", "$(P)IL:UPS:STAT")
#
#
# ### SIMULATION RECORDS ###
#
record(ai, "$(P)SIM:FREQ:REF")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
}
#
alias("$(P)DRIVE:MODE","$(P)SIM:DRIVE:MODE:SP")
#
alias("$(P)MB","$(P)SIM:MB:SP")
#
alias("$(P)PHAS","$(P)SIM:PHAS:SP")
alias("$(P)PHAS","$(P)SIM:PHAS:SP:RBV")
#
alias("$(P)FREQ","$(P)SIM:FREQ:SP")
alias("$(P)FREQ","$(P)SIM:FREQ:SP:RBV")
#
